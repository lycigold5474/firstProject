{{>layouts/header}}

<div id="formData" class="container">
    <h5>폼데이터로 전송 (form태그사용 x)</h5>
    <div class="mb-3">
        <label class="form-label">제목</label>
        <input type="text" class="form-control" name="title">
    </div>
    <div class="mb-3">
        <label class="form-label">내용</label>
        <textarea class="form-control" rows="3" name="content"></textarea>
    </div>
    <button type="button" class="btn btn-primary" onclick="submitForm()">form데이터 전송</button>
    <button type="button" class="btn btn-primary" onclick="submitJson()">json데이터 전송</button>
    <button type="button" class="btn btn-primary" onclick="saveJson()">json데이터 저장</button>
</div>

<script>
    function submitForm() {
        const result = fetchFormData('/articles/create1', createFormData());
        console.log('result', result);
    }

    function createFormData() {
        var formData = new FormData();
        var formElements = document.getElementById('formData').querySelectorAll('input, textarea');

        formElements.forEach(function(element) {
            formData.append(element.name, element.value);
        });

        return formData;
    }


    async function fetchFormData(url, data, method= 'POST') {
        try {
            const response = await fetch(url, {
                method: method,
                body: data
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const result = await response.json();
            console.log('요청이 성공했습니다.', result);
            return result;
        } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
            throw error;
        }
    }

    function submitJson() {
        const result = fetchJsonData('/articles/create2', createJsonData());
        console.log('result', result);
    }

    function saveJson() {
        const result = fetchJsonData('/articles/save', createJsonData());
        console.log('result', result);
    }

    function createJsonData() {
        var jsonData = {};
        var formElements = document.getElementById('formData').querySelectorAll('input, textarea');

        formElements.forEach(function(element) {
            jsonData[element.name] = element.value;
        });

        return jsonData;
    }


    async function fetchJsonData(url, data, method = 'POST') {
        try {
            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json', // Set the appropriate content type
                },
                body: data ? JSON.stringify(data) : null,
            });



            if (!response.ok) {
                console.log('HTTP 상태 코드:', response.status);
                throw new Error('Network response was not ok');
            }

            const result = await response.json();
            console.log('전체응답:', response);
            console.log('요청이 성공했습니다.', result);
            return result;

        } catch(error) {
            console.error('There was a problem with the fetch operation:', error);
            throw error;
        }
    }
</script>

{{>layouts/footer}}